<app-main-template>
  <div class="flex w-full justify-between">
    <h1 class="text-3xl">Batch</h1>
    <button
      class="flex items-center justify-center gap-3 rounded bg-lime-700 px-6 py-2 hover:bg-lime-600 dark:bg-lime-700 dark:hover:bg-lime-600"
      type="button"
      (click)="toggleModal(1)"
    >
      <p class="text-xs font-medium text-white">Add Batch</p>
      <ng-icon
        name="matPlusOutline"
        size="16px"
        class="mr-0 text-white"
      ></ng-icon>
    </button>
  </div>
  <hr class="mb-6 mt-2 h-[2px] w-full bg-neutral-300" />
  <div class="relative">
    <div
      class="rtl:inset-r-0 pointer-events-none absolute inset-y-0 start-0 flex items-center ps-3"
    >
      <ng-icon
        name="matFilterAltOutline"
        size="20px"
        class="mr-0 text-gray-400"
      ></ng-icon>
    </div>
    <input
      type="search"
      id="student-search"
      class="block w-60 rounded-lg border border-gray-300 bg-gray-50 ps-10 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-blue-500 dark:focus:ring-blue-500"
      placeholder="Filter by search"
      [(ngModel)]="searchText"
      (ngModelChange)="filterData()"
    />
  </div>
  <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <table
      class="w-full text-left text-sm text-neutral-800 dark:text-gray-400 rtl:text-right"
    >
      <thead
        class="text-md bg-neutral-100 text-center text-neutral-800 dark:bg-gray-700 dark:text-gray-400"
      >
        <tr>
          <th scope="col" class="px-6 py-3">Batch</th>
          <th scope="col" class="px-6 py-3">Minimum Hours</th>
          <th scope="col" class="px-6 py-3">Students</th>
          <th scope="col" class="px-1">Edit</th>
          <th scope="col" class="px-1">Visibility</th>
        </tr>
      </thead>
      <!-- BODY -->
      <tbody>
        <tr *ngIf="filteredBatches.length < 1">
          <td
            colspan="5"
            class="border-b bg-white p-3 text-center hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-600"
          >
            No results.
          </td>
        </tr>
        <tr
          class="border-t text-center dark:border-gray-700 dark:bg-gray-800 dark:hover:bg-gray-600"
          *ngFor="let i of getVisibleIndices()"
          [ngClass]="{
            'bg-gray-200 text-gray-500': filteredBatches[i].isActive == false,
            'bg-white': filteredBatches[i].isActive == true
          }"
        >
          <th
            scope="row"
            class="whitespace-nowrap px-6 py-4 font-medium dark:text-white"
          >
            {{ filteredBatches[i].batch }}
          </th>
          <td class="px-6 py-3">
            {{ filteredBatches[i].hours }}
          </td>
          <td class="px-6 py-3">{{ filteredBatches[i].students }}</td>
          <td class="px-1">
            <button
              class="inline-flex items-center rounded-lg p-2 text-center text-sm font-medium dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-600"
              type="button"
              (click)="toggleModal(2, undefined, filteredBatches[i].acadTerm)"
            >
              <ng-icon
                name="matEditOutline"
                size="24px"
                class="mr-0 text-gray-500 hover:text-gray-900"
              ></ng-icon>
            </button>
          </td>
          <td class="px-1">
            <button
              class="inline-flex items-center rounded-lg p-2 text-center text-sm font-medium dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-600"
              type="button"
              *ngIf="filteredBatches[i].isActive"
              matTooltip="Disable batch"
              (click)="toggleModal(3, undefined, filteredBatches[i].acadTerm)"
            >
              <ng-icon
                name="matGroupOffOutline"
                size="24px"
                class="mr-0 text-gray-500 hover:text-red-600"
              ></ng-icon>
            </button>
            <button
              class="inline-flex items-center rounded-lg p-2 text-center text-sm font-medium dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-600"
              type="button"
              *ngIf="!filteredBatches[i].isActive"
              matTooltip="Enable batch"
              (click)="toggleModal(4, undefined, filteredBatches[i].acadTerm)"
            >
              <ng-icon
                name="matGroupAddOutline"
                size="24px"
                class="mr-0 text-gray-500 hover:text-emerald-600"
              ></ng-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <mat-paginator
      [length]="filteredBatches.length"
      [pageSize]="pageSize"
      [showFirstLastButtons]="true"
      [pageSizeOptions]="pageSizeOptions"
      (page)="paginator.pageIndex = $event.pageIndex"
    >
    </mat-paginator>
  </div>
  <!-- ADD BATCH MODAL -->
  <app-modal
    *ngIf="idNum === 1"
    [isOpen]="isModalOpen"
    [hasHeader]="true"
    headerName="Add Batch"
    (eventToggleModal)="toggleModal(1, $event)"
  >
    <form
      class="flex flex-col gap-6"
      [formGroup]="addBatchForm"
      (submit)="submitBatch()"
    >
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Batch to be added:</h3>
        <input
          value="wewefsd"
          type="text"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="batch"
        />
      </div>
      <div class="ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Minimum Hours:</h3>
        <input
          type="number"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="minHours"
        />
      </div>
      <p
        class="mr-6 text-right text-sm text-red-600 dark:text-red-500"
        [ngStyle]="{
          display:
            addBatchForm.get('minHours')!.invalid && submitted
              ? 'block'
              : 'none'
        }"
      >
        Please fill the required field.
      </p>
      <hr />
      <button
        class="mt-3 w-full rounded bg-lime-600 px-6 py-3 text-center text-white hover:bg-lime-700"
        type="submit"
      >
        Add
      </button>
    </form>
  </app-modal>
  <!-- EDIT BATCH MODAL -->
  <app-modal
    *ngIf="idNum === 2"
    [isOpen]="isModalOpen"
    [hasHeader]="true"
    headerName="Edit Batch Details"
    (eventToggleModal)="toggleModal(2, $event)"
  >
    <form
      class="flex flex-col gap-6"
      [formGroup]="editBatchForm"
      (submit)="saveBatch(batchID)"
    >
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Batch</h3>
        <input
          value=""
          type="text"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="batch"
        />
      </div>
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Minimum Hours:</h3>
        <input
          type="number"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="minHours"
        />
      </div>
      <hr />
      <button
        class="w-full rounded bg-lime-600 px-6 py-3 text-center text-white hover:bg-lime-700"
        type="submit"
      >
        Save
      </button>
    </form>
  </app-modal>
  <!-- DISABLE BATCH MODAL -->
  <app-modal
    *ngIf="idNum === 3"
    [isOpen]="isModalOpen"
    [hasHeader]="true"
    headerName="Disable Batch"
    (eventToggleModal)="toggleModal(3, $event)"
    ><div class="text-center">
      <p class="text-sm font-normal">Are you sure in disabling this batch?</p>
    </div>
    <hr class="mb-4 mt-2 h-[2px] w-full bg-neutral-300" />
    <form [formGroup]="disableBatchForm" (submit)="disableBatch(batchID)">
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Batch</h3>
        <input
          value="wewefsd"
          type="text"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="batch"
        />
      </div>
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Minimum Hours</h3>
        <input
          value="AYCHUCHU"
          type="text"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="minHours"
        />
      </div>
      <button
        class="mt-6 flex w-full items-center justify-center gap-3 rounded bg-lime-700 px-6 py-2 hover:bg-lime-600 dark:bg-lime-700 dark:hover:bg-lime-600"
        type="submit"
      >
        <p class="text-xs font-medium text-white">Confirm</p>
      </button>
    </form>
  </app-modal>
  <!-- ENABLE BATCH MODAL -->
  <app-modal
    *ngIf="idNum === 4"
    [isOpen]="isModalOpen"
    [hasHeader]="true"
    headerName="Enable Batch"
    (eventToggleModal)="toggleModal(4, $event)"
    ><div class="text-center">
      <p class="text-sm font-normal">Are you sure in enabling this batch?</p>
    </div>
    <hr class="mb-4 mt-2 h-[2px] w-full bg-neutral-300" />
    <form [formGroup]="enableBatchForm" (submit)="enableBatch(batchID)">
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Batch</h3>
        <input
          value="wewefsd"
          type="text"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="batch"
        />
      </div>
      <div class="mb-3 ml-6 mr-6 flex place-items-center">
        <h3 class="grow text-base font-medium">Minimum Hours</h3>
        <input
          value="AYCHUCHU"
          type="text"
          class="border-[1px]rounded-md w-[60%] rounded border border-gray-300 bg-gray-50 px-3 py-1 text-sm dark:border-neutral-600"
          formControlName="minHours"
        />
      </div>
      <button
        class="mt-6 flex w-full items-center justify-center gap-3 rounded bg-lime-700 px-6 py-2 hover:bg-lime-600 dark:bg-lime-700 dark:hover:bg-lime-600"
        type="submit"
      >
        <p class="text-xs font-medium text-white">Confirm</p>
      </button>
    </form>
  </app-modal>
</app-main-template>
<app-loading></app-loading>
